{
  "version": 1,
  "routing": {
    "routing": {
      "domainStrategy": "IPIfNonMatch",
      "rules": [
        {
          "inboundTag": [
            "redirect",
            "tproxy"
          ],
          "network": "udp",
          "outboundTag": "vless-reality",
          "port": "3478-3480,3659,50000-50050,14000-14016,18000,20000-27200,21000-21500,23000-24000",
          "type": "field"
        },
        {
          "inboundTag": [
            "redirect",
            "tproxy"
          ],
          "network": "tcp",
          "outboundTag": "vless-reality",
          "port": "27014-27050,27015-27030",
          "type": "field"
        },
        {
          "domain": [
            "ext:geosite_zkeen.dat:domains",
            "ext:geosite_zkeen.dat:other",
            "ext:geosite_zkeen.dat:youtube",
            "domain:dis.gd",
            "domain:disboard.org",
            "domain:discord-activities.com",
            "domain:discord.center",
            "domain:discord.co",
            "domain:discord.com",
            "domain:discord.design"
          ],
          "inboundTag": [
            "redirect",
            "tproxy"
          ],
          "outboundTag": "vless-reality",
          "type": "field"
        },
        {
          "inboundTag": [
            "redirect",
            "tproxy"
          ],
          "ip": [
            "138.128.136.0/21",
            "162.158.0.0/15",
            "172.64.0.0/13",
            "34.0.0.0/15",
            "34.2.0.0/16",
            "34.3.0.0/23",
            "34.3.2.0/24",
            "35.192.0.0/12",
            "35.208.0.0/12",
            "35.224.0.0/12",
            "35.240.0.0/13",
            "5.200.14.128/25",
            "66.22.192.0/18",
            "104.16.0.0/12",
            "13.200.0.0/13",
            "13.208.0.0/12",
            "13.224.0.0/12",
            "13.24.0.0/13",
            "13.32.0.0/12",
            "13.48.0.0/13",
            "13.56.0.0/14",
            "143.204.0.0/16",
            "18.128.0.0/9",
            "18.32.0.0/11",
            "18.64.0.0/10",
            "188.114.96.0/22",
            "204.11.56.0/23",
            "23.227.32.0/19",
            "3.128.0.0/9",
            "ext:geoip_zkeenip.dat:akamai",
            "ext:geoip_zkeenip.dat:amazon",
            "ext:geoip_zkeenip.dat:cdn77",
            "ext:geoip_zkeenip.dat:cloudflare",
            "ext:geoip_zkeenip.dat:fastly",
            "ext:geoip_zkeenip.dat:discord",
            "ext:geoip_zkeenip.dat:meta",
            "ext:geoip_zkeenip.dat:telegram",
            "ext:geoip_zkeenip.dat:youtube",
            "ext:geoip_zkeenip.dat:google",
            "162.254.192.0/18",
            "208.64.200.0/21",
            "208.64.202.0/24",
            "208.64.203.0/24",
            "208.64.204.0/23",
            "208.64.206.0/23",
            "208.64.208.0/22",
            "208.64.212.0/22",
            "208.64.216.0/21",
            "23.32.0.0/11",
            "23.64.0.0/14",
            "23.192.0.0/12",
            "2.22.0.0/15",
            "96.17.0.0/16",
            "34.248.0.0/13",
            "52.28.64.0/19",
            "104.160.131.0/24",
            "172.65.212.0/24",
            "137.221.0.0/16",
            "8.252.0.0/15",
            "104.255.105.0/24",
            "92.223.0.0/16"
          ],
          "outboundTag": "vless-reality",
          "type": "field"
        },
        {
          "inboundTag": [
            "redirect",
            "tproxy"
          ],
          "outboundTag": "direct",
          "protocol": [
            "bittorrent"
          ],
          "type": "field"
        },
        {
          "inboundTag": [
            "redirect",
            "tproxy"
          ],
          "ip": [
            "127.0.0.0/8",
            "10.0.0.0/8",
            "172.16.0.0/12",
            "192.168.0.0/16",
            "169.254.0.0/16",
            "ext:geoip_zkeenip.dat:ru"
          ],
          "outboundTag": "direct",
          "type": "field"
        }
      ]
    }
  },
  "inbounds": {
    "inbounds": [
      {
        "tag": "tproxy",
        "port": 61219,
        "protocol": "dokodemo-door",
        "settings": {
          "network": "tcp,udp",
          "followRedirect": true
        },
        "streamSettings": {
          "sockopt": {
            "tproxy": "tproxy"
          }
        },
        "sniffing": {
          "routeOnly": true,
          "enabled": true,
          "destOverride": [
            "http",
            "tls",
            "quic"
          ]
        }
      }
    ]
  },
  "port_proxy": "#80\n#443\n#596:599\n\n# (Раскомментируйте/добавьте по образцу) единичные порты и диапазоны для проскирования\n",
  "port_exclude": "#\n\n# Одновременно использовать порты проксирования и исключать порты нельзя\n# Приоритет у портов проксирования\n",
  "ip_exclude": "#192.168.0.0/16\n#2001:db8::/32\n\n# Добавьте необходимые IP и подсети без комментария # для исключения их из проксирования\n",
  "mihomo": "# =============================================================\n# Mihomo / Clash Meta — полный конфиг\n# DNS управляется роутером Keenetic (dns: не используем)\n# =============================================================\n\nredir-port: 1182\ntproxy-port: 1181\nmixed-port: 1080\nallow-lan: true\nlog-level: silent\ngeodata-mode: true\ngeo-auto-update: true\ngeo-update-interval: 72\nfind-process-mode: off\nipv6: false\n\nexternal-controller: \"0.0.0.0:9090\"\nsecret: \"admin\"\nexternal-ui: ui\nexternal-ui-url: \"https://github.com/Zephyruso/zashboard/releases/download/v2.1.0/dist-no-fonts.zip\"\n\nprofile:\n  store-selected: true\n\nsniffer:\n  enable: true\n  parse-pure-ip: true\n  sniff:\n    HTTP:\n    TLS:\n    QUIC:\n\n# Геоданные (используются GEOSITE / GEOIP-правилами)\ngeox-url:\n  geosite: \"https://github.com/jameszeroX/zkeen-domains/releases/latest/download/zkeen.dat\"\n  geoip: \"https://github.com/jameszeroX/zkeen-ip/releases/latest/download/zkeenip.dat\"\n\n# =============================================================\n# 1. PROXY PROVIDERS (ПОДПИСКИ)\n# =============================================================\nproxy-providers:\n\n  my-vless-sub:\n    type: http\n    url: http://178.17.51.216:2096/sub/ee2nmtptt9uetv7t\n    path: ./proxy_providers/my-vless-sub.yaml\n    interval: 3600\n    health-check:\n      enable: true\n      url: http://www.gstatic.com/generate_204\n      interval: 300\n      timeout: 8000\n      lazy: true\n      expected-status: 204\n    override:\n      tfo: true\n      mptcp: true\n      udp: true\n\n  second-sub:\n    type: http\n    url: http://umarwelder.xyz:2096/sub/7gkf2wzh2nbj447z\n    path: ./proxy_providers/second-sub.yaml\n    interval: 3600\n    health-check:\n      enable: true\n      url: http://www.gstatic.com/generate_204\n      interval: 300\n      timeout: 8000\n      lazy: true\n      expected-status: 204\n    override:\n      tfo: true\n      mptcp: true\n      udp: true\n\n  third-sub:\n    type: http\n    url: http://94.232.40.60:2096/sub/ahfvh9dhozpwws83\n    path: ./proxy_providers/third-sub.yaml\n    interval: 3600\n    health-check:\n      enable: true\n      url: http://www.gstatic.com/generate_204\n      interval: 300\n      timeout: 8000\n      lazy: true\n      expected-status: 204\n    override:\n      tfo: true\n      mptcp: true\n      udp: true\n\n# =============================================================\n# 2. PROXY GROUPS (ГРУППЫ)\n# =============================================================\nproxy-groups:\n\n  # Автовыбор лучшего узла по задержке\n  - name: Auto-VPN\n    type: url-test\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Rocket.png\"\n    use:\n      - my-vless-sub\n      - second-sub\n      - third-sub\n    url: \"http://www.gstatic.com/generate_204\"\n    interval: 300\n    tolerance: 50\n    lazy: true\n\n  # Основная группа для ручного выбора\n  - name: Proxy-Selector\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Proxy.png\"\n    use:\n      - my-vless-sub\n      - second-sub\n      - third-sub\n    proxies:\n      - Auto-VPN\n      - DIRECT\n    default: DIRECT\n\n  - name: DOMAINS\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Puzzle.png\"\n    proxies:\n      - Proxy-Selector\n      - DIRECT\n\n  - name: OTHER\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Global.png\"\n    proxies:\n      - Proxy-Selector\n      - DIRECT\n\n  - name: Ru-Traffic\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Russia.png\"\n    use:\n      - my-vless-sub\n      - second-sub\n      - third-sub\n    proxies:\n      - DIRECT\n      - Proxy-Selector\n    default: DIRECT\n\n  - name: Ad-Filter\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/AdBlack.png\"\n    proxies:\n      - REJECT\n      - DIRECT\n    default: REJECT\n\n  - name: ECH-Refilter\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Direct.png\"\n    proxies:\n      - Proxy-Selector\n      - DIRECT\n    default: Proxy-Selector\n\n  - name: META\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Facebook.png\"\n    proxies:\n      - Proxy-Selector\n      - DIRECT\n\n  - name: AMAZON\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Amazon.png\"\n    proxies:\n      - Proxy-Selector\n      - DIRECT\n\n  - name: FASTLY\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Global.png\"\n    proxies:\n      - Proxy-Selector\n      - DIRECT\n\n  - name: AKAMAI\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Global.png\"\n    proxies:\n      - Proxy-Selector\n      - DIRECT\n\n  - name: GOOGLE\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Google.png\"\n    proxies:\n      - Proxy-Selector\n      - DIRECT\n\n  - name: CLOUDFLARE\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Cloudflare.png\"\n    proxies:\n      - DIRECT\n      - Proxy-Selector\n\n  - name: CDN77\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Global.png\"\n    proxies:\n      - DIRECT\n      - Proxy-Selector\n\n  - name: DIGITALOCEAN\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Global.png\"\n    proxies:\n      - DIRECT\n      - Proxy-Selector\n\n  - name: HETZNER\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Global.png\"\n    proxies:\n      - DIRECT\n      - Proxy-Selector\n\n  - name: GCORE\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Global.png\"\n    proxies:\n      - DIRECT\n      - Proxy-Selector\n\n  - name: LINODE\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Global.png\"\n    proxies:\n      - DIRECT\n      - Proxy-Selector\n\n  - name: MEGA\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Global.png\"\n    proxies:\n      - DIRECT\n      - Proxy-Selector\n\n  - name: ORACLE\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Global.png\"\n    proxies:\n      - DIRECT\n      - Proxy-Selector\n\n  - name: OVH\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Global.png\"\n    proxies:\n      - DIRECT\n      - Proxy-Selector\n\n  - name: VULTR\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Global.png\"\n    proxies:\n      - DIRECT\n      - Proxy-Selector\n\n  - name: Telegram\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Telegram.png\"\n    proxies:\n      - Proxy-Selector\n      - DIRECT\n\n  - name: Discord\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Discord.png\"\n    proxies:\n      - Proxy-Selector\n      - DIRECT\n\n  - name: Steam\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Steam.png\"\n    proxies:\n      - Proxy-Selector\n      - DIRECT\n\n  - name: YouTube\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/YouTube.png\"\n    use:\n      - my-vless-sub\n      - second-sub\n      - third-sub\n    proxies:\n      - Proxy-Selector\n    default: Proxy-Selector\n\n  - name: Torrent-Traffic\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Download.png\"\n    proxies:\n      - DIRECT\n      - Proxy-Selector\n\n  - name: POLITIC\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Media.png\"\n    proxies:\n      - DIRECT\n      - Proxy-Selector\n\n  - name: Global-Default\n    type: select\n    icon: \"https://cdn.jsdelivr.net/gh/Koolson/Qure@master/IconSet/Color/Final.png\"\n    proxies:\n      - DIRECT\n      - Proxy-Selector\n\n# =============================================================\n# 3. RULE PROVIDERS\n# =============================================================\nrule-providers:\n\n  discord_voiceips:\n    type: http\n    behavior: ipcidr\n    format: mrs\n    url: \"https://raw.githubusercontent.com/legiz-ru/mihomo-rule-sets/main/other/discord-voice-ip-list.mrs\"\n    path: ./rule-sets/discord-voice-ip-list.mrs\n    interval: 86400\n\n  discord_domains:\n    type: http\n    behavior: domain\n    format: mrs\n    url: \"https://github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/discord.mrs\"\n    path: ./rule-sets/discord_domains.mrs\n    interval: 86400\n\n  gaming-ips:\n    type: http\n    behavior: ipcidr\n    format: yaml\n    url: \"https://raw.githubusercontent.com/OMchik33/custom-rules/main/mihomo/gaming-ips.yaml\"\n    path: ./rule-sets/gaming-ips.yaml\n    interval: 86400\n\n  ru-app-list:\n    type: http\n    behavior: classical\n    format: yaml\n    url: \"https://github.com/legiz-ru/mihomo-rule-sets/raw/main/other/ru-app-list.yaml\"\n    path: ./rule-sets/ru-app-list.yaml\n    interval: 86400\n\n  steam-domain:\n    type: http\n    behavior: domain\n    format: yaml\n    url: \"https://raw.githubusercontent.com/OMchik33/custom-rules/refs/heads/main/mihomo/gaming-domains.yaml\"\n    path: ./rule-sets/steam-domain.yaml\n    interval: 86400\n\n  refilter_noech:\n    type: http\n    behavior: domain\n    format: mrs\n    url: \"https://github.com/legiz-ru/mihomo-rule-sets/raw/main/re-filter/re-filter-noech.mrs\"\n    path: ./re-filter/noech.mrs\n    interval: 86400\n\n  refilter_ech:\n    type: http\n    behavior: domain\n    format: mrs\n    url: \"https://github.com/legiz-ru/mihomo-rule-sets/raw/main/re-filter/re-filter-ech.mrs\"\n    path: ./re-filter/ech.mrs\n    interval: 86400\n\n  refilter_ipsum:\n    type: http\n    behavior: ipcidr\n    format: mrs\n    url: \"https://github.com/legiz-ru/mihomo-rule-sets/raw/main/re-filter/ip-rule.mrs\"\n    path: ./re-filter/ip-rule.mrs\n    interval: 86400\n\n  torrent-clients:\n    type: http\n    behavior: classical\n    format: yaml\n    url: \"https://github.com/legiz-ru/mihomo-rule-sets/raw/main/other/torrent-clients.yaml\"\n    path: ./rule-sets/torrent-clients.yaml\n    interval: 86400\n\n  torrent-trackers:\n    type: http\n    behavior: domain\n    format: mrs\n    url: \"https://raw.githubusercontent.com/legiz-ru/mihomo-rule-sets/main/other/torrent-trackers.mrs\"\n    path: ./rule-sets/torrent-trackers.mrs\n    interval: 86400\n\n  torrent-websites:\n    type: http\n    behavior: domain\n    format: mrs\n    url: \"https://raw.githubusercontent.com/legiz-ru/mihomo-rule-sets/main/other/torrent-websites.mrs\"\n    path: ./rule-sets/torrent-websites.mrs\n    interval: 86400\n\n  oisd_big:\n    type: http\n    behavior: domain\n    format: mrs\n    url: \"https://github.com/legiz-ru/mihomo-rule-sets/raw/main/oisd/big.mrs\"\n    path: ./oisd/big.mrs\n    interval: 86400\n\n  oisd_small:\n    type: http\n    behavior: domain\n    format: mrs\n    url: \"https://github.com/legiz-ru/mihomo-rule-sets/raw/main/oisd/small.mrs\"\n    path: ./oisd/small.mrs\n    interval: 86400\n\n  oisd_nsfw_small:\n    type: http\n    behavior: domain\n    format: mrs\n    url: \"https://github.com/legiz-ru/mihomo-rule-sets/raw/main/oisd/nsfw_small.mrs\"\n    path: ./oisd/nsfw_small.mrs\n    interval: 86400\n\n  oisd_nsfw_big:\n    type: http\n    behavior: domain\n    format: mrs\n    url: \"https://github.com/legiz-ru/mihomo-rule-sets/raw/main/oisd/nsfw.mrs\"\n    path: ./oisd/nsfw_big.mrs\n    interval: 86400\n\n# =============================================================\n# 4. RULES\n# =============================================================\nrules:\n\n  # Локальная сеть и DNS в обход прокси\n  - IP-CIDR,192.168.0.0/16,DIRECT,no-resolve\n  - IP-CIDR,10.0.0.0/8,DIRECT,no-resolve\n  - IP-CIDR,172.16.0.0/12,DIRECT,no-resolve\n  - IP-CIDR,127.0.0.0/8,DIRECT,no-resolve\n  - DST-PORT,53,DIRECT\n\n  # Реклама / NSFW (oisd — режем в Ad-Filter)\n  - RULE-SET,oisd_small,Ad-Filter\n  - RULE-SET,oisd_big,Ad-Filter\n  - RULE-SET,oisd_nsfw_small,Ad-Filter\n  - RULE-SET,oisd_nsfw_big,Ad-Filter\n\n  # IP-чекеры — всегда через VPN (Proxy-Selector)\n  - OR,((DOMAIN,ipwho.is),(DOMAIN,api.ip.sb),(DOMAIN,ipapi.co),(DOMAIN,ipinfo.io),(DOMAIN,2ip.io),(DOMAIN,2ip.ru)),Proxy-Selector\n\n  # ================== ПРИОРИТЕТ: ИГРЫ / МЕССЕНДЖЕРЫ / СТРИМ ==================\n\n  # Discord — домены, GEOIP, голос, STUN/WebRTC и диапазоны портов\n  - OR,((RULE-SET,discord_domains),(GEOIP,DISCORD),(RULE-SET,discord_voiceips),(DST-PORT,3478-3480),(DST-PORT,5222-5223),(DST-PORT,5228),(DST-PORT,5242),(DST-PORT,50000-50100)),Discord\n\n  # Steam и общий игровой трафик — домены, IP-сети, игровые порты\n  - OR,((RULE-SET,steam-domain),(RULE-SET,gaming-ips),(DST-PORT,3659),(DST-PORT,14000-14016),(DST-PORT,18000),(DST-PORT,20000-26000),(DST-PORT,21000-21500),(DST-PORT,23000-24000),(DST-PORT,27015),(DST-PORT,27031-27036),(DST-PORT,27036)),Steam\n\n  # YouTube — стриминг/видеоконтент, важен для игр и медиаконтента\n  - OR,((GEOSITE,YOUTUBE),(GEOIP,YOUTUBE)),YouTube\n\n  # Telegram (часто используется для игровых комьюнити/каналов)\n  - GEOIP,TELEGRAM,Telegram\n\n  # Игровые CDN / дата-центры — много игр, лаунчеров и античитов сидят здесь\n  - GEOIP,AKAMAI,AKAMAI\n  - GEOIP,AMAZON,AMAZON\n  - GEOIP,CDN77,CDN77\n  - GEOIP,CLOUDFLARE,CLOUDFLARE\n  - GEOIP,DIGITALOCEAN,DIGITALOCEAN\n  - GEOIP,FASTLY,FASTLY\n  - GEOIP,GCORE,GCORE\n  - GEOIP,HETZNER,HETZNER\n  - GEOIP,LINODE,LINODE\n  - GEOIP,ORACLE,ORACLE\n  - GEOIP,OVH,OVH\n  - GEOIP,VULTR,VULTR\n\n  # ================== ПРОЧИЙ СПЕЦИАЛЬНЫЙ ТРАФИК ==================\n\n  # Торренты\n  - OR,((RULE-SET,torrent-clients),(RULE-SET,torrent-trackers)),Torrent-Traffic\n  - RULE-SET,torrent-websites,Torrent-Traffic\n\n  # Российские приложения и IP-сети\n  - RULE-SET,ru-app-list,Ru-Traffic\n  - GEOIP,RU,Ru-Traffic\n\n  # Re-filter / ECH\n  - RULE-SET,refilter_ech,ECH-Refilter\n  - RULE-SET,refilter_noech,ECH-Refilter\n  - RULE-SET,refilter_ipsum,ECH-Refilter\n\n  # Основные GeoSite-категории (всё остальное по доменным спискам)\n  - GEOSITE,DOMAINS,DOMAINS\n  - GEOSITE,OTHER,OTHER\n  - GEOSITE,POLITIC,POLITIC\n\n  # Финальное правило — всё, что не матчнулось выше\n  - MATCH,Global-Default\n"
}